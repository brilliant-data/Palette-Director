# FOR TESTING (NOT Tableau Apache)
# Include this config file in the Apache httpd.conf file
# eg. Include /PATH_TO_CONFIG/director_httpd.conf

# FIXME - the module seems to be get loaded twice at startup.
# If the following settings are in a VirtualHost then both load is successful
# Might cause any issue with Tableau httpd.conf
<VirtualHost *:80>
    # Try to suppress missing server name Apache warning at startup
    ServerName director_test

    # These modules are required for the Director to work
    LoadModule proxy_module modules/mod_proxy.so
    LoadModule proxy_http_module modules/mod_proxy_http.so
    LoadModule proxy_balancer_module modules/mod_proxy_balancer.so

    # Unclear what slotmem_shm_module is for but was needed
    LoadModule slotmem_shm_module modules/mod_slotmem_shm.so

    # Load the Director module
    LoadModule lbmethod_bybusyness_module /PATH_TO_MODULE/mod_palette_director.so

    # Configuration file for the Webauthor role (URLs ending with showAuthoring)
    # eg.
    # This works  -  http://director_test/test/showAuthoring
    # It does NOT -  http://director_test/test/showAuthoring?:site=Marketing
    # FIXME - Might need a RewriteRule or change the code
    AuthoringBindingConfigPath /PATH_TO_CONFIG/authoringbinding.csv

    # Configuration file for others
    # eg. http://director_test/test/?:site=Marketing
    WorkerBindingConfigPath /PATH_TO_CONFIG/workerbinding.csv

    # Makes the configuration settings available via the /worker-bindings URL
    <Location /worker-bindings>
        SetHandler palette-director-status
    </Location>

    # The settings of the balancer members can be changed with this (eg. turn on/off)
    <Location "/balancer-manager">
        SetHandler balancer-manager
    </Location>

    # LB Nodes
    <Proxy balancer://mycluster>
        BalancerMember http://worker1
        BalancerMember http://worker2
        BalancerMember http://worker3
    </Proxy>

    # Enable the balancer for the /test URL
    # Set the Director (bybusyness method) as lb provider
    ProxyPass /test balancer://mycluster lbmethod=bybusyness

</VirtualHost>
